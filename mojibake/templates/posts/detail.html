{% extends "header.html" %}
{% set active_page = "/post/{}".format(post.slug) %}


{% block leftbar %}
<!-- picture? -->
{{ _('By: {username}'.format(username='<a href="{profile_url}">{username}</a>'.format(profile_url=(url_for('profile', username = post.author.username)), username = post.author.username))) }}
<h5>{{ _('Categories') }}</h5>
<ul class="unstyled">
    {% for tag in post.tags %}
    <li><a href="{{ url_for('tags', tag = tag) }}">{{tag}}</a></li>
    {% endfor %}
</ul>
{% endblock %}


{% block content %}
<h3>{{post.title}}</h3>
<p><em>{{moment_js(post.created_at).format('LLLL')}}</em> -  <em>{{moment_js(post.created_at).fromNow()}}</em></p>
{% if g.user.is_authenticated() %}
<p><a href="{{ url_for('posts.edit_post', slug=slug) }}">{{ _('Edit Post') }}</a> | <a href="{{ url_for('posts.delete_post', slug=slug) }}">{{ _('Delete Post') }}</a></p>
{% endif %}
<p>{{post.body_html|safe}}</p>
<div id="comment_block">
<h4>{{ _('Comments') }}</h4>
{% if user %}
<form action="" method="post" name="edit">
    {{form.hidden_tag()}}
    <p>{{form.body}}</p>
    {% for error in form.errors.body %}
    <div class="alert alert-error">
        <p>{{error}}</p>
    </div>
    {% endfor %}
    <p><input class="btn btn-primary" type="submit" value="{{ _('Submit') }}"></p>
</form>
{% else %}
<form action="" method="post" name="edit">
    {{form.hidden_tag()}}

    <p>Author:</p>
    <p>{{form.author}}</p>
    {% for error in form.errors.author %}
    <div class="alert alert-error">
        <p>{{error}}</p>
    </div>
    {% endfor %}
    <p>Email: </p>
    <p>{{form.email}}</p>
    {% for error in form.errors.email %}
    <div class="alert alert-error">
        <p>{{error}}</p>
    </div>
    {% endfor %}
    <p>Comment: </p>
    <p>{{form.body}}</p>
    {% for error in form.errors.body %}
    <div class="alert alert-error">
        <p>{{error}}</p>
    </div>
    {% endfor %}
    <p><input class="btn btn-primary" type="submit" value="{{ _('Submit') }}"></p>
</form>
{% endif %}
{% if post.get_visible_comments() %}
    {% for comment in post.get_visible_comments() %}
        {% include 'posts/comment.html' %}
    {% endfor %}
{% endif %}
</div>
{% endblock %}